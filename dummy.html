<!-- scripts for blog -->
 <script>
          // Check if user is logged in and is an author
          document.addEventListener('DOMContentLoaded', function() {
              checkAuthForBlog();
              renderUserPosts();
          });
  
          function checkAuthForBlog() {
              const user = getCurrentUser();
              if (!user) {
                  window.location.href = 'login.html';
                  return;
              }
              
              if (user.role !== 'author') {
                  showAlert('Only authors can create posts', 'error');
                  setTimeout(() => {
                      window.location.href = user.role === 'admin' ? 'admin-dashboard.html' : 'display-blog.html';
                  }, 2000);
                  return;
              }
              
              document.getElementById('userInfo').textContent = `${user.username} (${user.role})`;
              if (user.role === 'admin') {
                  document.getElementById('adminLink').style.display = 'inline-block';
              }
          }
  
          function renderUserPosts() {
              const user = getCurrentUser();
              if (!user) return;
              
              const posts = getPosts()
                  .filter(post => post.author === user.username)
                  .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                  .slice(0, 5); // Show only recent 5 posts
              
              const container = document.getElementById('userPostsContainer');
              
              if (posts.length === 0) {
                  container.innerHTML = '<p class="no-posts">You haven\'t created any posts yet.</p>';
                  return;
              }
              
              container.innerHTML = posts
                  .map(post => `
                      <div class="user-post-item">
                          <h4>${escapeHTML(post.title)}</h4>
                          <p class="post-date">${formatDate(post.createdAt)}</p>
                          <div class="post-actions">
                              <button onclick="editPost('${post.id}')" class="btn btn-small btn-secondary">Edit</button>
                              <button onclick="deletePost('${post.id}')" class="btn btn-small btn-danger">Delete</button>
                          </div>
                      </div>
                  `)
                  .join('');
          }
      </script>


<!-- scripts for admin -->
 <script>
      document.addEventListener("DOMContentLoaded", function () {
        checkAuthForAdmin();
        renderAdminDashboard();
      });

      function checkAuthForAdmin() {
        const user = getCurrentUser();
        if (!user) {
          window.location.href = "login.html";
          return;
        }

        if (user.role !== "admin") {
          showAlert("Access denied. Admin privileges required.", "error");
          setTimeout(() => {
            window.location.href =
              user.role === "author" ? "blog.html" : "display-blog.html";
          }, 2000);
          return;
        }

        document.getElementById(
          "userInfo"
        ).textContent = `${user.username} (${user.role})`;
      }

      function renderAdminDashboard() {
        renderStats();
        renderUsers();
        renderRecentPosts();
      }

      function renderStats() {
        const users = getUsers();
        const posts = getPosts();

        const authors = users.filter((user) => user.role === "author");
        const admins = users.filter((user) => user.role === "admin");

        document.getElementById("totalUsers").textContent = users.length;
        document.getElementById("totalPosts").textContent = posts.length;
        document.getElementById("totalAuthors").textContent = authors.length;
        document.getElementById("totalAdmins").textContent = admins.length;
      }

      function renderUsers() {
        const users = getUsers().sort((a, b) =>
          a.username.localeCompare(b.username)
        );
        renderFilteredUsers(users);
      }

      function renderFilteredUsers(users) {
        const container = document.getElementById("usersContainer");

        if (users.length === 0) {
          container.innerHTML = '<div class="no-users">No users found.</div>';
          return;
        }

        container.innerHTML = users
          .map((user) => createUserCard(user))
          .join("");
      }

      function createUserCard(user) {
        const posts = getPosts().filter(
          (post) => post.author === user.username
        );
        const postCount = posts.length;
        const lastPost =
          posts.length > 0
            ? posts.sort(
                (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
              )[0]
            : null;

        return `
                <div class="user-card">
                    <div class="user-card-header">
                        <h4 class="user-name">${escapeHTML(user.username)}</h4>
                        <span class="user-role ${user.role}">${user.role}</span>
                    </div>
                    <div class="user-card-stats">
                        <div class="user-stat">
                            <span class="stat-number">${postCount}</span>
                            <span class="stat-label">Posts</span>
                        </div>
                        ${
                          lastPost
                            ? `
                            <div class="user-stat">
                                <span class="stat-label">Last Post:</span>
                                <span class="stat-text">${formatDate(
                                  lastPost.createdAt
                                )}</span>
                            </div>
                        `
                            : ""
                        }
                    </div>
                </div>
            `;
      }

      function renderRecentPosts() {
        const posts = getPosts()
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .slice(0, 5);

        const container = document.getElementById("recentPostsContainer");

        if (posts.length === 0) {
          container.innerHTML = '<div class="no-posts">No posts found.</div>';
          return;
        }

        container.innerHTML = posts
          .map(
            (post) => `
                    <div class="recent-post-item">
                        <h4 class="recent-post-title">${escapeHTML(
                          post.title
                        )}</h4>
                        <div class="recent-post-meta">
                            <span class="recent-post-author">By ${escapeHTML(
                              post.author
                            )}</span>
                            <span class="recent-post-date">${formatDate(
                              post.createdAt
                            )}</span>
                        </div>
                        <p class="recent-post-excerpt">${escapeHTML(
                          post.content.substring(0, 100)
                        )}...</p>
                    </div>
                `
          )
          .join("");
      }

      function searchUsers() {
        const searchTerm = document
          .getElementById("userSearch")
          .value.toLowerCase();
        const roleFilter = document.getElementById("roleFilter").value;

        let users = getUsers();

        if (searchTerm) {
          users = users.filter((user) =>
            user.username.toLowerCase().includes(searchTerm)
          );
        }

        if (roleFilter) {
          users = users.filter((user) => user.role === roleFilter);
        }

        users = users.sort((a, b) => a.username.localeCompare(b.username));
        renderFilteredUsers(users);
      }

      function filterUsers() {
        searchUsers(); // Reuse the search function
      }
    </script>


<!-- display blog  -->
 <script>
        let displayedPosts = 0;
        const postsPerPage = 6;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuthForDisplay();
            renderPosts();
        });

        function checkAuthForDisplay() {
            const user = getCurrentUser();
            if (user) {
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('userInfo').style.display = 'inline-block';
                document.getElementById('userInfo').textContent = `${user.username} (${user.role})`;
                
                if (user.role === 'author') {
                    document.getElementById('createPostLink').style.display = 'inline-block';
                }
                
                if (user.role === 'admin') {
                    document.getElementById('adminLink').style.display = 'inline-block';
                }
            }
        }

        function renderPosts() {
            const posts = getPosts()
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            renderFilteredPosts(posts);
        }

        function renderFilteredPosts(posts) {
            const container = document.getElementById('postsContainer');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="no-posts-large">No posts found. <a href="blog.html">Create the first post!</a></div>';
                loadMoreContainer.style.display = 'none';
                return;
            }
            
            const postsToShow = posts.slice(0, displayedPosts + postsPerPage);
            displayedPosts = postsToShow.length;
            
            container.innerHTML = postsToShow
                .map(post => createPostCard(post))
                .join('');
            
            // Show/hide load more button
            if (displayedPosts < posts.length) {
                loadMoreContainer.style.display = 'block';
            } else {
                loadMoreContainer.style.display = 'none';
            }
        }

        function createPostCard(post) {
            const currentUser = getCurrentUser();
            const canEdit = currentUser && currentUser.username === post.author;
            const imageHTML = post.image ? 
                `<div class="post-image-container">
                    <img src="${post.image}" alt="${post.title}" class="post-image" onerror="this.parentElement.style.display='none'">
                </div>` : '';
            
            const actionsHTML = canEdit ? `
                <div class="post-card-actions">
                    <button class="btn btn-small btn-secondary" onclick="editPostFromDisplay('${post.id}')">Edit</button>
                    <button class="btn btn-small btn-danger" onclick="deletePost('${post.id}')">Delete</button>
                </div>
            ` : '';
            
            return `
                <div class="post-card">
                    ${imageHTML}
                    <div class="post-card-content">
                        <h3 class="post-card-title">${escapeHTML(post.title)}</h3>
                        <div class="post-card-meta">
                            <span class="post-author">By ${escapeHTML(post.author)}</span>
                            <span class="post-date">${formatDate(post.createdAt)}</span>
                        </div>
                        <p class="post-card-excerpt">${escapeHTML(post.content.substring(0, 150))}${post.content.length > 150 ? '...' : ''}</p>
                        ${actionsHTML}
                    </div>
                </div>
            `;
        }

        function loadMorePosts() {
            renderPosts();
        }

        function editPostFromDisplay(postId) {
            // Store the post ID to edit and redirect to blog page
            localStorage.setItem('editPostId', postId);
            window.location.href = 'blog.html';
        }

        function searchPosts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const posts = getPosts();
            
            const filteredPosts = posts
                .filter(post => 
                    post.title.toLowerCase().includes(searchTerm) ||
                    post.content.toLowerCase().includes(searchTerm) ||
                    post.author.toLowerCase().includes(searchTerm)
                )
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            displayedPosts = 0; // Reset pagination
            renderFilteredPosts(filteredPosts);
        }
    </script>